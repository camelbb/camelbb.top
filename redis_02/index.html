<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="一点一滴积累，一步一个脚印"><title>Redis模块RediSeach | 米花の博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Redis模块RediSeach</h1><a id="logo" href="/.">米花の博客</a><p class="description">学习和生活中的碎碎念</p></div><div id="nav-menu"><a href="/"><i class="fa fa-home"> 首页</i></a><a href="/learn/"><i class="fa fa-home"> 学习</i></a><a href="/life/"><i class="fa fa-archive"> 碎碎念</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Redis模块RediSeach</h1><div class="post-meta">Aug 4, 2017<span> | </span><span class="category"><a href="/categories/Redis/">Redis</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><blockquote>
<p>Redis4.0版本开始支持通过外部模块进行功能性扩展。<br>Redis的模块采用的是动态链接库的方式，可以启动的时候加载，也可以在运行时加载（MODULE LOAD）。<br>要实现分离，首先需要的是初始化，以便让框架可以找到对应的方法，这就需要进行注册，Redis通过RedisModule_Init方法进行注册模块，和RedisModule_CreateCommand注册自定义方法。<br>Redis进行模块化，可以扩大Redis的生态圈，满足一些扩展性功能需求，现在就有一个Hub用于收集Redis模块的插件。</p>
</blockquote>
<h2 id="RediSearch简介"><a href="#RediSearch简介" class="headerlink" title="RediSearch简介"></a>RediSearch简介</h2><p><a href="http://redisearch.io/" title="http://redisearch.io/" target="_blank" rel="external">http://redisearch.io/</a></p>
<p>RediSearch是一个高性能的全文搜索引擎，可作为一个Redis Module 运行在Redis上，是由RedisLabs团队开发的。</p>
<h3 id="主要特性"><a href="#主要特性" class="headerlink" title="主要特性"></a>主要特性</h3><p>RediSearch 是在Redis基础上从0开始开发的一个全文搜索索引，使用新的Redis Modules API来扩展Redis新命令和能力，它的主要特性包括：</p>
<ul>
<li>简单，快速索引和搜索</li>
<li>数据存储在内存中，使用内存-有效的自定义数据结构</li>
<li>支持多种使用UTF-8编码的语言</li>
<li>文档和字段评分</li>
<li>结果的数值过滤</li>
<li>通过词干扩展查询</li>
<li>精确的短语搜索</li>
<li>按特定属性过滤结果（例如仅在标题中搜索“foo”）</li>
<li>强大的自动提示引擎</li>
<li>增量索引（不需要对索引进行优化和压缩）</li>
<li>支持用作存储在另一数据库中的文档的搜索索引</li>
<li>支持已经在Redis中存在的HASH对象作为文件的索引</li>
<li>扩展到多个Redis实例</li>
</ul>
<p>简介：<br>Redisearch实现了在Redis中使用搜索引擎，但不同于其他redis搜索库，它不使用内部数据结构排序集。<br>这使得它具备高性能，如精确短语匹配和数字的文本查询过滤，这种高效的搜索方法在传统redis中几乎不可能。</p>
<h2 id="安装方法"><a href="#安装方法" class="headerlink" title="安装方法"></a>安装方法</h2><p>以下是官方给出的安装方式（动态加载redis module）：<br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">git clone https:<span class="string">//github.com/RedisLabsModules/RediSearch.git</span></div><div class="line"><span class="keyword">cd</span> RediSearch/src</div><div class="line">make all</div><div class="line"></div><div class="line"><span class="comment"># Assuming you have a redis build from the unstable branch:</span></div><div class="line"><span class="string">/path/to/redis-server</span> <span class="params">--loadmodule</span> <span class="string">./redisearch.so</span></div></pre></td></tr></table></figure></p>
<p>也可以通过修改配置文件redis.conf加载redis module，在redis.conf加入以下语句<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">loadmodule <span class="regexp">/path/</span>to<span class="regexp">/redis/m</span>odules<span class="regexp">/redisearch.so</span></div></pre></td></tr></table></figure></p>
<p>启动redis<br><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/path/<span class="keyword">to</span>/redis-<span class="built_in">server</span> redis.conf</div></pre></td></tr></table></figure></p>
<h2 id="RediSearch命令"><a href="#RediSearch命令" class="headerlink" title="RediSearch命令"></a>RediSearch命令</h2><p>来源官方文档 <a href="http://redisearch.io/Commands/#ftcreate" title="http://redisearch.io/Commands/#ftcreate" target="_blank" rel="external">http://redisearch.io/Commands/#ftcreate</a></p>
<p><strong>FT.CREATE<br>创建一个索引，这个索引的名字被用于所有的键值，所以要尽可能的短</strong><br>Format:<br>  FT.CREATE {index}<br>    [NOOFFSETS] [NOFIELDS] [NOSCOREIDX]<br>    [STOPWORDS {num} {stopword} …]<br>    SCHEMA {field} [TEXT [WEIGHT {weight}] | NUMERIC | GEO] [SORTABLE] …</p>
<p><strong>FT.ADD<br>在索引中新增一个文档</strong><br>Format:<br>FT.ADD {index} {docId} {score}<br>  [NOSAVE]<br>  [REPLACE]<br>  [LANGUAGE {language}]<br>  [PAYLOAD {payload}]<br>  FIELDS {field} {value} [{field} {value}…]</p>
<p><strong>FT.ADDHASH<br>创建一个文档到已存在的hash索引</strong><br>Format：<br> FT.ADDHASH {index} {docId} {score} [LANGUAGE language] [REPLACE]</p>
<p><strong>FT.INFO<br>返回索引的内容和统计信息</strong><br>Format<br>FT.INFO {index} </p>
<p><strong>FT.SEARCH<br>搜索索引的文本内容，返回文本内容或id</strong><br>Format<br>FT.SEARCH {index} {query} [NOCONTENT] [VERBATIM] [NOSTOPWORDS] [WITHSCORES] [WITHPAYLOADS] [WITHSORTKEYS]<br>  [FILTER {numeric_field} {min} {max}] …<br>  [GEOFILTER {geo_field} {lon} {lat} {raius} m|km|mi|ft]<br>  [INKEYS {num} {key} … ]<br>  [INFIELDS {num} {field} … ]<br>  [RETURN {num} {field} … ]<br>  [SLOP {slop}] [INORDER]<br>  [LANGUAGE {language}]<br>  [EXPANDER {expander}]<br>  [SCORER {scorer}]<br>  [PAYLOAD {payload}]<br>  [SORTBY {field} [ASC|DESC]]<br>  [LIMIT offset num]</p>
<p><strong>FT.EXPLAIN<br>执行一个搜索的过程</strong><br>Format<br>FT.EXPLAIN {index} {query}</p>
<p><strong>删除：</strong><br>FT.DEL {index} {doc_id}<br>FT.DROP {index}</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">新增SCHEMA</div><div class="line">FT<span class="selector-class">.CREATE</span> user_test SCHEMA username TEXT age NUMERIC location GEO</div><div class="line"></div><div class="line">写入内容</div><div class="line">FT<span class="selector-class">.ADD</span> user_test a1 <span class="number">1.0</span> FIELDS username <span class="string">"lilei"</span> age <span class="number">26</span> location <span class="string">"12,55"</span></div><div class="line"></div><div class="line">查询</div><div class="line">FT<span class="selector-class">.SEARCH</span> user_test <span class="string">"lilei"</span></div></pre></td></tr></table></figure>
<p><strong>[查询例子]：</strong></p>
<ol>
<li><p><strong>查询包含hell和world</strong><br>hello world</p>
</li>
<li><p><strong>查询hello world，hello后紧跟world</strong><br>“hello world”</p>
</li>
<li><p><strong>包含hello或world</strong><br>hello|world</p>
</li>
<li><p><strong>包含hello但没有world</strong><br>hello -world</p>
</li>
<li><p><strong>组合查询</strong><br>(hello|halo) (world|werld)<br>hello -(world|werld)<br>(barack|barrack) obama</p>
<p> Optional terms with higher priority to ones containing more matches:<br> obama ~barack ~michelle</p>
<p> Exact phrase in one field, one word in aonther field:<br> @title:”barack obama” @job:president</p>
<p> Combined AND, OR with field specifiers:<br> @title:hello world @body:(foo bar) @category:(articles|biographies)</p>
</li>
<li><p><strong>模糊查询:</strong><br>hello worl<em><br>hel</em> worl<em><br>hello -worl</em></p>
</li>
<li><p><strong>price的范围200-500:</strong><br>@name:tv @price:[200 500]<br>age&gt;18<br>@age:[(18 +inf]</p>
</li>
</ol>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://www.mi-hua.com/redis_02/" data-id="cj6c7roa300182clczgk6l7d3" class="article-share-link">分享</a><div class="tags"><a href="/tags/Redis/">Redis</a></div><div class="post-nav"><a href="/swoole_01/" class="pre">swoole学习笔记</a><a href="/php-06/" class="next">获取客户端IP</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://www.mi-hua.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/HTTP/">HTTP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JS/">JS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/">Redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/go的安装步骤/">go的安装步骤</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/">nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/常用工具小记/">常用工具小记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/高可用系统/">高可用系统</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Go/" style="font-size: 15px;">Go</a> <a href="/tags/HTTP/" style="font-size: 15px;">HTTP</a> <a href="/tags/HTTP2/" style="font-size: 15px;">HTTP2</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/php/" style="font-size: 15px;">php</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/常用工具小记/" style="font-size: 15px;">常用工具小记</a> <a href="/tags/高可用系统/" style="font-size: 15px;">高可用系统</a> <a href="/tags/JS/" style="font-size: 15px;">JS</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/swoole_01/">swoole学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/redis_02/">Redis模块RediSeach</a></li><li class="post-list-item"><a class="post-list-link" href="/php-06/">获取客户端IP</a></li><li class="post-list-item"><a class="post-list-link" href="/system_01/">高可用系统构建原则-限流(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/go-01/">go学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/511/">nginx动态加载模块</a></li><li class="post-list-item"><a class="post-list-link" href="/http-01/">HTTP/2.0协议</a></li><li class="post-list-item"><a class="post-list-link" href="/php_04/">PhpSpreadsheet导出Excel</a></li><li class="post-list-item"><a class="post-list-link" href="/php-05/">php必包语法用法</a></li><li class="post-list-item"><a class="post-list-link" href="/nodejs-01/">CentOS 下安装 Node.js</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">米花の博客.</a><br/> 
<a href='http://www.miitbeian.gov.cn'>备案号：粤ICP备14045825号-1</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>